<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="/public/css/bootstrap.css" />
    <link rel="stylesheet" href="/public/css/style.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js"></script>
    <script src="/controllers/sesionCtrl.js"></script>
    <script src="/socket.io/socket.io.js"></script>
</head>
<%- include("layout.html"); %>
<body ng-app="sesion" ng-controller="sesionCtrl">
    <script>
        var socket = io.connect(window.location.host);
        socket.on('start',function (data) {
            document.location.reload(true);
        });
        socket.on('ver_result',function (data) {
            document.location.reload(true);
        });
        socket.on('resultado',function (data) {
            if ("<%= creador %>" == "true")
            counter.innerHTML += data.namePart + " ya envió sus decisiones <br>";
        });
    </script>
    <div class="col-md-4 col-md-offset-4">
        Conectados: <br>
        <% names.forEach(function(nombre) { %>
            <%= nombre %><br>
        <% }); %>
        <div id="chat-window2">
            <div id="test"></div>
        </div>
        Index: <%= indexEsc %><br>
        <% if (creador) { %>
            <% revisados.forEach(function(r) { %>
                <%= r  %> ya envió sus decisiones <br>
            <% }); %>
        <% } %>
        <div id="counter"></div>
        <div id="mario-chat">
            <div id="chat-window">
                <div id="output"></div>
            </div>
            <input type="hidden" id="handle" value="<%= username %>">
            <input type="hidden" id="idSesion" value="<%= idSesion %>">
            <%= username %>: <input id="message" type="text" placeholder="Message" onkeypress="myFunction(event)">
            <button id="send">Send</button>
        </div>
        <br><br>
        <script src="/public/js/cliente.js"></script>
        <script src="/public/js/moderador.js"></script>

        <% if (noresultado) { %>
            <% if (creador) { %>
                <form method="post" action="/sesion/escenario/<%= idSesionEnc %>/<%= indexEsc %>/<%= idPartEnc %>/<%= username %>">
                    <input type="hidden" id="iniciar" value="<%= idSesion %>">
                    <input type="hidden" id="handle" value="<%= username %>">
                    <button type="submit" id = "iniciar_sesion" class="btn btn-lg btn-info">Iniciar sesión</button>
                </form>
                <script src="/public/js/start.js"></script>
            <% } %>

            <% if (inicio) { %>
                <form method="post" name ="inicio" action="/sesion/escenario/<%= idSesionEnc %>/<%= indexEsc %>/<%= idPartEnc %>/<%= username %>">
                    <input type="hidden" id="iniciar" value="<%= idSesion %>">
                    <input type="hidden" id="handle" value="<%= username %>">
                    <body onload = "document.inicio.submit();"></body>
                </form>
            <% } %>
        <% } else { %>
            <% if (creador) { %>
                <form method="post" action="/sesion/escenario/resultado/<%= idSesionEnc %>/<%= indexEsc %>/<%= idPartEnc %>/<%= username %>">
                    <input type="hidden" id="iniciar" value="<%= idSesion %>">
                    <input type="hidden" id="handle" value="<%= username %>">
                    <button type="submit" id = "mostrar_resultados" class="btn btn-lg btn-info">Mostrar Resultados</button>
                </form>
                <script >
                    var result = document.getElementById('mostrar_resultados');
                    result.addEventListener('click',function () {
                        socket.emit('ver_result', {
                        });
                    });
                </script>
            <% } %>

            <% if (ver_resultado) { %>
                <form method="post" name = "result" action="/sesion/escenario/resultado/<%= idSesionEnc %>/<%= indexEsc %>/<%= idPartEnc %>/<%= username %>">
                    <input type="hidden" id="iniciar" value="<%= idSesion %>">
                    <input type="hidden" id="handle" value="<%= username %>">
                    <body onload = "document.result.submit();"></body>
                </form>
            <% } %>

            <% if (inicio) { %>
                <form method="post" name ="inicio" action="/sesion/escenario/resultado/<%= idSesionEnc %>/<%= indexEsc %>/<%= idPartEnc %>/<%= username %>">
                    <input type="hidden" id="iniciar" value="<%= idSesion %>">
                    <input type="hidden" id="handle" value="<%= username %>">
                    <body onload = "document.inicio.submit();"></body>
                </form>
            <% } %>
        <% } %>
    </div>
</body>
</html>